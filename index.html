<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="html2adf.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.0.2/tinymce.min.js" integrity="sha512-Cwez4r594AFwCqWzXklkW90mGiJCKJBhcFb8GsWWtb0coKuR9uv1ozODWidI/8Lr9iKunYaXLPf6VJtL3rXzyQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      tinymce.init({
        selector: '#mytextarea',
        plugins: 'preview importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media template codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount help charmap quickbars emoticons',
        editimage_cors_hosts: ['picsum.photos'],
        menubar: 'file edit view insert format tools table help',
        toolbar: 'undo redo | bold italic underline strikethrough | fontfamily fontsize blocks | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl',
        toolbar_sticky: true,
        autosave_ask_before_unload: true,
        autosave_interval: '30s',
        autosave_prefix: '{path}{query}-{id}-',
        autosave_restore_when_empty: false,
        autosave_retention: '2m',
        image_advtab: true,
      });
    
      function submitForm(){
          var contents = tinymce.activeEditor.getContent();
          var documentFragment = createElementFromHTML(contents);
          // document.getElementById("testBox").appendChild(documentFragment)
          
          testBox = document.getElementById("testBox");
          testBox.innerHTML = contents;
        }

        function cleanText (){
        tinymce.activeEditor.setContent('<p></p>', { format: 'html' })
      }

      function ConvertHtmlToJson () {
        var contents = tinymce.activeEditor.getContent();
        var documentFragment = createElementFromHTML(contents);
        var jsonNodes = htmlToJsonNodes(documentFragment)          
        
        var testBox = document.getElementById("testBox");
        testBox.innerHTML = contents;

        var jsonBox = document.getElementById("jsonBox");
        jsonBox.innerHTML = JSON.stringify(jsonNodes);

        // var adf = {
        //   "version": 1,
        //   "type": "doc",
        //   "content": jsonNodesToADF(jsonNodes)
        // }

        var adf = html2adf(contents)

        var adfBox = document.getElementById("adfBox");
        adfBox.innerHTML =JSON.stringify(adf);


      }

      function createElementFromHTML(htmlString) {
        var div = document.createElement('div');
        div.innerHTML = htmlString.trim();

        // Change this to div.childNodes to support multiple top-level nodes.
        return div;
      }

</script>

  </head>

  <body>
  <h1>Simple HTML to ADF (Atlassian Document Format) transformer</h1>
    <form">
      <textarea id="mytextarea"></textarea>
    </form>
    <button id="submitButton" onclick="javascript:submitForm();">Create Ticket</button>
    <button id="cleanText" onclick="javascript:cleanText();">Clean Text</button>
    <button id="htmlToJson" onclick="javascript:ConvertHtmlToJson();">HTML to Json</button>
    <div>ADF BOX</div>
    <div id="adfBox"></div><br>
    <div>JSON BOX</div>
    <div id="jsonBox"></div><br>
    <div>HTML BOX</div><br>
    <div id="testBox"></div>
  </body>
</html>


